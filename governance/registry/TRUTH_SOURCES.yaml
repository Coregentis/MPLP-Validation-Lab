# Truth Sources Registry - v0.7.2
#
# SSOT for all truth sources used by Validation Lab.
# v0.7.2: P0 Projection gates integration (projection-map SSOT)
#
# Governance: REPO_SHAPE.md / VLAB-DGB-01

version: "0.7.2"
schema_version: "1.0.0"
description: |
  Registry of all truth sources referenced by PTM and gates.
  Every truth source must be registered with its resolver type and audit output location.

# =============================================================================
# Audit Configuration
# =============================================================================

audit:
  output_file: "artifacts/truth-source-inventory.json"
  include_glob_expansion: true
  include_file_hashes: true

# =============================================================================
# Truth Source Definitions
# =============================================================================

sources:
  # ---------------------------------------------------------------------------
  # L1 Governance: Identity & Policies
  # ---------------------------------------------------------------------------
  ts.identity:
    path: "verifier/VERIFIER_IDENTITY.json"
    resolver: "file"
    type: "json"
    description: "Verifier identity, signing keys, and key policy"
    used_by_routes:
      - "/"
      - "/about"
    
  ts.terminology:
    path: "governance/TERMINOLOGY_MAPPING.md"
    resolver: "file"
    type: "markdown"
    description: "LG/GF terminology mapping (frozen)"
    used_by_routes:
      - "/guarantees"
      - "/runs/*"
    
  ts.dgb:
    path: "governance/VLAB-DGB-01.md"
    resolver: "file"
    type: "markdown"
    description: "Development Governance Baseline"
    used_by_routes:
      - "/statement"
      - "/"

  ts.coverage_addendum:
    path: "governance/COVERAGE_GOVERNANCE_ADDENDUM.md"
    resolver: "file"
    type: "markdown"
    description: "Coverage Governance Addendum (Claim Gates & SSOT rules)"
    used_by_routes:
      - "/coverage"
      - "/policies/contract"

  # ---------------------------------------------------------------------------
  # L1 Governance: Contracts
  # ---------------------------------------------------------------------------
  ts.contracts:
    paths:
      - "governance/contracts/evidence-pack-contract-v1.0.md"
      - "governance/contracts/evidence-pack-contract-v1.1.md"
      - "governance/contracts/admission-criteria-v1.0.md"
      - "governance/contracts/ruleset-contract-v1.0.md"
      - "governance/contracts/pointer-contract-v1.0.md"
    resolver: "file_list"
    type: "markdown"
    description: "Evidence pack and ruleset contracts"
    used_by_routes:
      - "/policies/contract"

  ts.strength:
    path: "governance/evidence/EVIDENCE_STRENGTH.md"
    resolver: "file"
    type: "markdown"
    description: "Evidence strength policy (E-A/E-B/E-S)"
    used_by_routes:
      - "/policies/strength"

  # ---------------------------------------------------------------------------
  # L2 Data: Runsets
  # ---------------------------------------------------------------------------
  ts.runsets:
    path: "governance/runsets.yaml"
    resolver: "file"
    type: "yaml"
    description: "Runsets SSOT (curated / cross_substrate / test_vectors)"
    used_by_routes:
      - "/runs"
      - "/runs/*"
      - "/coverage"

  ts.curated_allowlist:
    path: "data/curated-runs/allowlist.yaml"
    resolver: "file"
    type: "yaml"
    description: "Curated runs allowlist"
    used_by_routes:
      - "/runs"

  ts.export_curated_json:
    path: "export/curated-runs.json"
    resolver: "file"
    type: "json"
    description: "Export contract surface (public SSOT for curated runs)."
    used_by_routes:
      - "/runs"
      - "/runs/*"
      - "/coverage"

  ts.ui_curated_json:
    path: "public/_data/curated-runs.json"
    resolver: "file"
    type: "json"
    description: "Generated UI projection data (derived from export)."
    used_by_routes:
      - "/runs"

  ts.substrate_index:
    path: "data/curated-runs/substrate-index.yaml"
    resolver: "file"
    type: "yaml"
    description: "Canonical substrate index for consistency checks"
    used_by_routes:
      - "/runs"
      - "/runs/*"
      - "/coverage"

  # ---------------------------------------------------------------------------
  # L2 Data: Rulesets
  # ---------------------------------------------------------------------------
  ts.registry:
    path: "lib/rulesets/registry.ts"
    resolver: "module_export"
    type: "code"
    exports:
      - "getRuleset"
      - "getAllRulesets"
    description: "Ruleset registry (code module)"
    used_by_routes:
      - "/rulesets"
      - "/rulesets/*"
      - "/runs/*"

  ts.ruleset_manifests:
    path: "data/rulesets/*/manifest.yaml"
    resolver: "glob"
    type: "yaml"
    audit_output: "artifacts/truth-source-inventory.json#ts.ruleset_manifests"
    description: "Ruleset manifest files"
    expectation: "non_empty"
    used_by_routes:
      - "/rulesets"
      - "/rulesets/*"

  # ---------------------------------------------------------------------------
  # L2 Data: Run Bundles
  # ---------------------------------------------------------------------------
  ts.run_bundles:
    path: "data/runs/*"
    resolver: "directory"
    type: "directory"
    audit_output: "artifacts/truth-source-inventory.json#ts.run_bundles"
    description: "Curated run bundle directories"
    expectation: "non_empty"
    used_by_routes:
      - "/runs/*"
      - "/runs/*/replay"
      - "/runs/*/evidence"

  # ---------------------------------------------------------------------------
  # L2 Data: Cross-Substrate Producers (v0.5)
  # ---------------------------------------------------------------------------
  ts.producer_contract:
    path: "producers/contract/PRODUCER_CONTRACT.md"
    resolver: "file"
    type: "markdown"
    description: "Cross-substrate producer contract"
    used_by_routes:
      - "/examples/evidence-producers/*"

  ts.producer_manifests:
    path: "producers/*/manifest.yaml"
    resolver: "glob"
    type: "yaml"
    audit_output: "artifacts/truth-source-inventory.json#ts.producer_manifests"
    description: "Producer manifest files for each substrate"
    expectation: "may_be_empty"
    used_by_routes:
      - "/examples/evidence-producers/*"

  ts.producer_packs:
    path: "producers/*/packs/*"
    resolver: "glob"
    type: "directory"
    audit_output: "artifacts/truth-source-inventory.json#ts.producer_packs"
    description: "Cross-substrate evidence packs"
    expectation: "may_be_empty"
    used_by_routes:
      - "/examples/evidence-producers/*"

  # ---------------------------------------------------------------------------
  # L2 Data: Test Vectors (v0.5)
  # ---------------------------------------------------------------------------
  ts.test_vectors_allowlist:
    path: "test-vectors/v0.5/allowlist-v0.5.yaml"
    resolver: "file"
    type: "yaml"
    description: "Test vectors allowlist"
    used_by_routes:
      - "/coverage"

  ts.test_vectors:
    path: "test-vectors/v0.5/vectors/*"
    resolver: "glob"
    type: "directory"
    audit_output: "artifacts/truth-source-inventory.json#ts.test_vectors"
    description: "Public test vector packs"
    expectation: "may_be_empty"
    used_by_routes:
      - "/coverage"

  # ---------------------------------------------------------------------------
  # L4 UI: Schemas (for builder)
  # ---------------------------------------------------------------------------
  ts.pack_schema:
    path: "lib/schemas/evidence-pack/*.yaml"
    resolver: "glob"
    type: "yaml"
    audit_output: "artifacts/truth-source-inventory.json#ts.pack_schema"
    description: "Evidence pack JSON schemas"
    expectation: "may_be_empty"
    used_by_routes:
      - "/builder"

  # ---------------------------------------------------------------------------
  # L2 Data: Adjudication Evidence (v0.6)
  # ---------------------------------------------------------------------------
  ts.coverage_matrix:
    path: "adjudication/matrix/coverage*.yaml"
    resolver: "glob"
    type: "yaml"
    description: "Multi-substrate coverage matrix definitions"
    used_by_routes:
      - "/coverage"

  # ---------------------------------------------------------------------------
  # P1 Capability Truth Sources (v0.8 MUST-1/MUST-3)
  # ---------------------------------------------------------------------------
  ts.proof_sets:
    path: "adjudication/proof-sets/**"
    resolver: "glob"
    type: "yaml"
    description: "MUST-1 same-ruler proof sets (cross-substrate adjudication consistency)"
    expectation: "non_empty"
    used_by_routes:
      - "/adjudication/proof-sets"

  ts.ruleset_diff_reports:
    path: "export/ruleset-diff/**/*.json"
    resolver: "glob"
    type: "json"
    description: "MUST-3 ruleset version diff reports"
    expectation: "may_be_empty"
    used_by_routes:
      - "/rulesets/diff"

  ts.ruleset_diff_index:
    path: "export/ruleset-diff/index.json"
    resolver: "file"
    type: "json"
    description: "Index of available ruleset diff reports"
    expectation: "may_be_empty"
    used_by_routes:
      - "/rulesets/diff"

  ts.projection_manifest:
    path: "export/projection-manifest.json"
    resolver: "file"
    type: "json"
    description: "Provable baseline manifest (hashes + repo anchors)"
    expectation: "non_empty"
    used_by_routes:
      - "/"
      - "/about"
      - "/statement"

  # ---------------------------------------------------------------------------
  # Registry SSOT Layer (v0.7 Auditability)
  # ---------------------------------------------------------------------------
  ts.registry.routes:
    path: "governance/registry/ROUTES.yaml"
    resolver: "file"
    type: "yaml"
    description: "Registry SSOT: routes"
    expectation: "non_empty"
    used_by_routes: ["/*"]

  ts.registry.gates:
    path: "governance/registry/GATES.yaml"
    resolver: "file"
    type: "yaml"
    description: "Registry SSOT: gates"
    expectation: "non_empty"
    used_by_routes: ["/*"]

  ts.registry.truth_sources:
    path: "governance/registry/TRUTH_SOURCES.yaml"
    resolver: "file"
    type: "yaml"
    description: "Registry SSOT: truth sources"
    expectation: "non_empty"
    used_by_routes: ["/*"]

  ts.ptm:
    path: "governance/page-truth/ptm-0.7.yaml"
    resolver: "file"
    type: "yaml"
    description: "Page Truth Map (v0.7)"
    expectation: "non_empty"
    used_by_routes: ["/*"]

  ts.dispute_benchmark:
    path: "adjudication/dispute-benchmark-fail-01/**"
    resolver: "glob"
    type: "directory"
    description: "Dispute benchmark sample for FAIL closure"
    used_by_routes:
      - "/adjudication"
      - "/runs/*"

# =============================================================================
# Summary
# =============================================================================

summary:
  total_sources: 22
  by_resolver:
    file: 13
    file_list: 1
    glob: 7
    module_export: 1
